import{u as c,a as S,r as u,j as e,T as f,B as E,b as F,S as k,c as y}from"./index-CtcFTY0g.js";import{u as v,a as C,F as m,b as l,I as x}from"./userStore-C_NTiAIu.js";import{d as I,c as L,a as p,u as M,F as d,o as U}from"./delay-BMHq5jaK.js";import{V as B}from"./chunk-NTCQBYKE-DvrqvTdJ.js";const P="mock-token",T=async(o,t)=>{if(await I(500),o==="user"&&t==="password")return{success:!0,token:P,user:{id:"1",username:o,email:"username@example.com",bio:"テスト用の自己紹介です。"}};throw new Error("ユーザー名またはパスワードに誤りがあります")},q=L().shape({username:p().required("ユーザー名は必須です"),password:p().required("パスワードは必須です")}),V=()=>{const{register:o,handleSubmit:t,formState:{errors:n}}=v({resolver:U(q)}),h=c(s=>s.authenticate),g=c(s=>s.logout),j=C(s=>s.setCurrentUser),w=S(),r=M({mutationFn:s=>T(s.username,s.password),onSuccess:s=>{s!=null&&s.token&&(s!=null&&s.user)&&(h(s.token),j({...s.user}),w(y))},onError:s=>{console.error(s),g()}}),i=u.useCallback(async s=>{await r.mutateAsync(s)},[r]),b=u.useMemo(()=>{var s,a;return e.jsx("form",{onSubmit:t(i),children:e.jsxs(B,{spacing:4,children:[e.jsxs(m,{isInvalid:!!n.username,children:[e.jsx(l,{children:"ユーザー名"}),e.jsx(x,{...o("username")}),e.jsx(d,{children:(s=n.username)==null?void 0:s.message})]}),e.jsxs(m,{isInvalid:!!n.password,children:[e.jsx(l,{children:"パスワード"}),e.jsx(x,{type:"password",...o("password")}),e.jsx(d,{children:(a=n.password)==null?void 0:a.message})]}),r.isError&&e.jsx(f,{color:"red.500",children:r.error.message}),e.jsx(E,{type:"submit",colorScheme:"blue",width:"full",isLoading:r.isPending,children:"Login"})]})})},[n,o,t,i,r.isError,r.error,r.isPending]);return e.jsx(F,{maxWidth:"400px",margin:"auto",mt:8,children:r.isPending?e.jsx(k,{}):b})};export{V as LoginForm};
